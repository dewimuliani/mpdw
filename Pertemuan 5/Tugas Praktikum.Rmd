---
title: "Tugas 5"
author: "Dewi Muliani"
date: "2025-09-28"
output: html_document
---

```{r}
library(ggplot2)
library(tsibble)
library(tseries)
library(MASS)
```

# Input data kopi
```{r}
library(rio)
data_coffee <- import("https://raw.githubusercontent.com/diazaria/mpdw/refs/heads/main/Pertemuan%201/Data%20Kelompok%205_Harga%20Kopi.xlsx")

library(dplyr)
data_coffee <- select(data_coffee, -1)

# subset baris 301 - 400
data_coffee_sub <- data_coffee[301:400, ]

# mengambil kolom ke-2 (harga kopi)
y_sub <- data_coffee_sub[[2]]   

# mengambil tahun dan bulan dari baris pertama subset data
start_year  <- as.numeric(format(data_coffee_sub$`Date (Monthly)`[1], "%Y"))
start_month <- as.numeric(format(data_coffee_sub$`Date (Monthly)`[1], "%m"))

# mengubah data agar terbaca sebagai data deret waktu
data_coffee_sub.ts <- ts(y_sub,
                         start = c(start_year, start_month),
                         frequency = 12)
```

# Plot Time Series
```{r}
plot_coffee <- data_coffee_sub.ts |> 
  as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() +
  theme_bw() +
  xlab("Time Period") +
  ylab("Coffee Arabica ($/kg)") +
  ggtitle("Time Series Plot of Coffee Arabica")

# Tampilkan plot
plot_coffee

# Hitung rata-rata
mean(data_coffee_sub.ts)
```

```{r}
lattice::densityplot(as.vector(data_coffee_sub.ts))
```

Berdasarkan plot time series tersebut, terlihat bahwa data tidak stasioner dalam rataan, ditandai dengan adanya trend pada data dan tidak stasioner dalam ragam yang ditandai dengan adanya perbedaan lebar pita pada plot

# Plot ACF
```{r}
acf(data_coffee_sub.ts)
```
Berdasarkan plot ACF, terlihat bahwa plot ACF pada data tersebut menurun secara perlahan (*tails off slowly*) sehingga mengindikasikan adanya kecenderungan tren atau unit root pada data. Pola ini menunjukkan indikasi bahwa data tidak stasioner dalam rataan.

# Uji ADF
```{r}
adf.test(data_coffee_sub.ts)
```
Namun, pada uji ADF terlihat bahwa p-value sebesar 0.024 (< 0.05) sehingga hipotesis nol ditolak dan data dinyatakan stasioner. Dengan demikian, meskipun secara visual tampak adanya tren, namun secara statistik data tersebut sudah memenuhi asumsi stasioner dalam rataan.

# Plot Box-Cox
```{r}
index <- seq(1:100)
bc <- boxcox(data_coffee_sub.ts~index, lambda = seq(-2, 2, 0.01))
#Nilai Rounded Lambda
lambda <- bc$x[which.max(bc$y)]
lambda
#SK
bc$x[bc$y > max(bc$y) - 1/2 * qchisq(.95,1)]
```
Gambar di atas menunjukkan nilai *rounded value* ($\lambda$) optimum sebesar **-0.37** dan pada selang kepercayaan 95% nilai memiliki batas bawah **-0.74** dan batas atas **0.00**. Selang tersebut tidak memuat nilai satu sehingga dapat dikatakan bahwa data kopi tidak stasioner dalam ragam.

# Partisi Data
## Bagian 1
```{r}
dtgab1 <- data_coffee_sub.ts[1:80] |> ts()
# Hitung rata-rata
mean(dtgab1)
# Hitung ragam
var(dtgab1)
```

### Plot Time Series
```{r}
dtgab1 |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() + theme_bw() +
  xlab("Time Periode") + ylab("Coffee Arabica ($/kg)")
```

Berdasarkan plot time series tersebut, terlihat bahwa data cenderung tidak stasioner dalam rataan, ditandain dengan adanya trend pada data, serta tidak stasioner dalam ragam, ditandai dengan lebar pita yang cenderung tidak sama pada plot tersebut

### Plot ACF
```{r}
acf(dtgab1)
```
Berdasarkan plot ACF, terlihat bahwa plot ACF pada data tersebut menurun secara perlahan (*tails off slowly*) yang menandakan data tidak stasioner dalam rataan.

### Uji ADF
```{r}
adf.test(dtgab1)
```
Hasil analisis menunjukkan bahwa pada data gabungan 1, uji ADF Tidak tolak hipotesis nol sehingga data dinyatakan data gabungan 1 tidak stasioner dalam rataan, namun pada data keseluruhan uji ADF menghasilkan p-value yang signifikan sehingga data dinyatakan stasioner dalam rataan. Perbedaan ini terjadi karena subset hanya merepresentasikan periode awal dengan tren yang masih dominan, sedangkan pada keseluruhan periode fluktuasi data lebih seimbang sehingga secara statistik memenuhi asumsi stasioner dalam rataan.

### Plot Box-Cox
```{r}
index <- seq(1:80)
bc <- boxcox(dtgab1~index, lambda = seq(-2, 2, 0.01))
#Nilai Rounded Lambda
lambda <- bc$x[which.max(bc$y)]
lambda
#SK
bc$x[bc$y > max(bc$y) - 1/2 * qchisq(.95,1)]
```

Gambar di atas menunjukkan nilai *rounded value* ($\lambda$) optimum sebesar **-0.45** dan pada selang kepercayaan 95% nilai memiliki batas bawah **-1.02** dan batas atas **0.11**. Selang tersebut tidak memuat nilai satu sehingga dapat dikatakan bahwa data kopi tidak stasioner dalam ragam.

## Bagian 2
```{r}
dtgab2 <- data_coffee_sub.ts[81:100] |> ts()
# Hitung rata-rata
mean(dtgab2)
# Hitung ragam
var(dtgab2)
```

### Plot Time Series
```{r}
dtgab2 |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() + theme_bw() +
  xlab("Time Periode") + ylab("Coffee Arabica ($/kg)")
```

Berdasarkan plot time series tersebut, terlihat bahwa data cenderung tidak stasioner dalam rataan, ditandain dengan adanya trend pada data, serta  cenderung stasioner dalam ragam, ditandai dengan lebar pita yang cenderung sama pada plot tersebut

### Plot ACF
```{r}
acf(dtgab2)
```

Berdasarkan plot ACF, terlihat bahwa plot ACF pada data tersebut menurun secara perlahan (*tails off slowly*) yang menandakan data tidak stasioner dalam rataan.

### Uji ADF
```{r}
adf.test(dtgab2)
```
Hasil analisis pada data gabungan 2 juga menunjukkan uji ADF Tidak tolak hipotesis nol sehingga data dinyatakan data gabungan 2 juga tidak stasioner dalam rataan. Perbedaan dengan data keseluruhan ini dapat terjadi karena subset hanya merepresentasikan periode akhir dengan tren yang masih dominan, sedangkan pada keseluruhan periode fluktuasi data lebih seimbang sehingga secara statistik memenuhi asumsi stasioner dalam rataan.

### Plot Box-Cox
```{r}
index <- seq(81:100)
bc <- boxcox(dtgab2~index, lambda = seq(-2, 2, 0.01))
#Nilai Rounded Lambda
lambda <- bc$x[which.max(bc$y)]
lambda
#SK
bc$x[bc$y > max(bc$y) - 1/2 * qchisq(.95,1)]
```

Gambar di atas menunjukkan nilai *rounded value* ($\lambda$) optimum sebesar **0.81** dan pada selang kepercayaan 95% nilai memiliki batas bawah **-2.00** dan batas atas **2.00**. Selang tersebut memuat nilai satu sehingga dapat dikatakan bahwa data kopi stasioner dalam ragam.

# Penanganan Kestasioneran
## Transformasi Box-Cox
```{r}
library(forecast)

lambda_opt <- -0.37
data_coffee_sub_bc <- BoxCox(data_coffee_sub.ts, lambda = lambda_opt)

plot(data_coffee_sub_bc, main = paste("Box-Cox Transform (λ =", round(lambda_opt, 2), ")"),
     ylab = "Transformed Harga", col = "blue")

# Plot Box-Cox setelah transformasi
index <- seq_along(data_coffee_sub_bc)
b = boxcox(data_coffee_sub_bc~index, lambda = seq(-1,4,by=1))
```
Gambar di atas menunjukkan selang memuat nilai satu sehingga dapat dikatakan bahwa data setelah transformasi stasioner dalam ragam.

## Diferensiasi setelah transformasi
```{r}
data_coffee_sub_bc_diff1 = diff(data_coffee_sub_bc, differences = 1)

plot(data_coffee_sub_bc_diff1, main = "First Differencing after Box-Cox", 
     ylab = "Δ Harga", col = "darkgreen")
```

### Plot ACF dan PACF Setelah Diferensiasi
```{r}
# Cek ACF & ADF setelah differencing
acf(data_coffee_sub_bc_diff1, main = "ACF setelah First Differencing")
pacf(data_coffee_sub_bc_diff1, main = "PACF setelah First Differencing")
```
Berdasarkan plot ACF dan PACF setelah first differencing, autokorelasi hanya signifikan pada lag awal dan cepat melemah. Hal ini menunjukkan bahwa data telah menjadi stasioner dalam rataan setelah dilakukan diferensiasi pertama.

### Uji ADF Setelah Diferensiasi
```{r}
adf.test(data_coffee_sub_bc_diff1)
```
Pada uji ADF terlihat bahwa p-value sebesar 0.01 (< 0.05) sehingga hipotesis nol ditolak dan data dinyatakan stasioner.

## Identifikasi Model
```{r}
# Model ARIMA(1,1,0)
fit_arima110 <- Arima(data_coffee_sub.ts, order = c(1, 1, 0), lambda = lambda_opt)
summary(fit_arima110)

# Model ARIMA(0,1,1)
fit_arima011 <- Arima(data_coffee_sub.ts, order = c(0, 1, 1), lambda = lambda_opt)
summary(fit_arima011)

# Model ARIMA(1,1,1)
fit_arima111 <- Arima(data_coffee_sub.ts, order = c(1, 1, 1), lambda = lambda_opt)
summary(fit_arima111)

# Bandingkan kriteria AIC, BIC, AICc
AIC(fit_arima110, fit_arima011, fit_arima111)
BIC(fit_arima110, fit_arima011, fit_arima111)
```

Berdasarkan hasil perbandingan nilai AIC, diperoleh bahwa model ARIMA(1,1,0) memiliki nilai AIC sebesar -288.1515, yang lebih kecil dibandingkan dengan model ARIMA(0,1,1) sebesar -287.1119 dan model ARIMA(1,1,1) sebesar -286.1624. Karena kriteria pemilihan model ARIMA didasarkan pada nilai AIC terendah, maka model ARIMA(1,1,0) dipilih sebagai model terbaik di antara ketiga kandidat. Dengan demikian, model ini dianggap lebih efisien dalam menjelaskan data tanpa menambah kompleksitas parameter yang berlebihan.
