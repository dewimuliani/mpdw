---
title: "Tugas Praktikum 1"
author: "Dewi Muliani"
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Latihan Praktikum 1

```{r}
library("forecast")
library("graphics")
library("TTR")
library("TSA")
```

```{r}
library(rio)
data_coffee <- import("https://github.com/diazaria/mpdw/raw/main/Pertemuan%201/Data%20Kelompok%205_Harga%20Kopi.xlsx")
View(data_coffee)

library(dplyr)
data_coffee <- select(data_coffee, -1)

# subset baris 301 - 400
data_coffee_sub <- data_coffee[301:400, ]

# mengambil kolom ke-2 (harga kopi)
y_sub <- data_coffee_sub[[2]]   

# mengambil tahun dan bulan dari baris pertama subset data
start_year  <- as.numeric(format(data_coffee_sub$`Date (Monthly)`[1], "%Y"))
start_month <- as.numeric(format(data_coffee_sub$`Date (Monthly)`[1], "%m"))

# mengubah data agar terbaca sebagai data deret waktu
data_coffee_sub.ts <- ts(y_sub,
                         start = c(start_year, start_month),
                         frequency = 12)

# menampilkan ringkasan data
summary(data_coffee_sub.ts)

# membuat plot data deret waktu
ts.plot(data_coffee_sub.ts, 
        xlab = "Time Period", 
        ylab = "Coffee Arabica ($/kg)", 
        main = "Time Series Plot of Coffee Arabica")

points(data_coffee_sub.ts)
```

### Pembagian Data Latih dan Uji

```{r}
# membagi data training dan testing dengan perbandingan 80% data latih dan 20% data uji.
training <- data_coffee_sub[1:80, ]
testing  <- data_coffee_sub[81:100, ]

# mengambil kolom ke-2 pada data training (harga kopi)
y_train <- training[[2]]

# mengambil tahun dan bulan dari baris pertama data training
start_year_train  <- as.numeric(format(training$`Date (Monthly)`[1], "%Y"))
start_month_train <- as.numeric(format(training$`Date (Monthly)`[1], "%m"))

# mengubah ke time series
train.ts <- ts(y_train,
               start = c(start_year_train, start_month_train),
               frequency = 12)

# mengambil kolom ke-2 pada data testing (harga kopi)
y_test <- testing[[2]]

# mengambil tahun dan bulan dari baris pertama testing
start_year_test  <- as.numeric(format(testing$`Date (Monthly)`[1], "%Y"))
start_month_test <- as.numeric(format(testing$`Date (Monthly)`[1], "%m"))

# mengubah ke time series
test.ts <- ts(y_test,
              start = c(start_year_test, start_month_test),
              frequency = 12)

```

### Eksplorasi

```{r}
plot(data_coffee_sub.ts, col="black",main="Plot semua data")
points(data_coffee_sub.ts)

plot(train.ts, col="red",main="Plot data latih")
points(train.ts)

plot(test.ts, col="blue",main="Plot data uji")
points(test.ts)
```

#### Dengan ggplot2

```{r}
# mengganti nama kolom agar lebih mudah
colnames(training)[2] <- "Harga"
colnames(testing)[2]  <- "Harga"
colnames(training)[1] <- "Periode"
colnames(testing)[1]  <- "Periode"

# Membuat plot
library(ggplot2)
ggplot() + 
  geom_line(data = training, aes(x = Periode, y = Harga, col = "Data Latih")) +
  geom_line(data = testing, aes(x = Periode, y = Harga, col = "Data Uji")) +
  labs(x = "Periode Waktu", 
       y = "Harga Kopi Arabica ($/kg)", 
       color = "Legend") +
  scale_colour_manual(name = "Keterangan:", 
                      breaks = c("Data Latih", "Data Uji"),
                      values = c("blue", "red")) + 
  theme_bw() + 
  theme(legend.position = "bottom",
        plot.caption = element_text(hjust = 0.5, size = 12))

```

### Metode Pemulusan Double Exponential Smoothing (DES)

Digunakan metode double exponential smoothing pada data ini dikarenakan data kopi pada eksplorasi menunjukkan pola tren (tidak konstan). DES mampu menangkap komponen level dan tren sehingga lebih sesuai dibanding metode sederhana (SES) atau moving average.

```{r}
# Model DES dengan parameter optimum
des.opt <- HoltWinters(train.ts, gamma = FALSE)
des.opt
plot(des.opt)

#ramalan
ramalandesopt<- forecast(des.opt, h=20)
ramalandesopt

#Model DES dengan Lamda=0.2 dan gamma=0.2
des.1<- HoltWinters(train.ts, gamma = FALSE, beta = 0.2, alpha = 0.2)
plot(des.1)

#ramalan
ramalandes1<- forecast(des.1, h=20)
ramalandes1

# Model DES dengan Lamda=0.6 dan gamma=0.3
des.2<- HoltWinters(train.ts, gamma = FALSE, beta = 0.3, alpha = 0.6)
plot(des.2)

#ramalan
ramalandes2<- forecast(des.2, h=20)
ramalandes2
```

```{r}
# membandingkan plot data latih dan data uji dengan Model DES 2 dan optimum dikarenakan ramalan mengikuti pola data uji dengan cukup baik
plot(data_coffee_sub.ts)
lines(des.2$fitted[,1], lty=2, col="blue")
lines(ramalandes2$mean, col="red")

plot(data_coffee_sub.ts)
lines(des.opt$fitted[,1], lty=2, col="blue")
lines(ramalandesopt$mean, col="red")
```

#### Akurasi Data Latih

```{r}
ssedes.train1<-des.1$SSE
msedes.train1<-ssedes.train1/length(train.ts)
sisaandes1<-ramalandes1$residuals
head(sisaandes1)

mapedes.train1 <- sum(abs(sisaandes1[3:length(train.ts)]/train.ts[3:length(train.ts)])
                      *100)/length(train.ts)

akurasides.1 <- matrix(c(ssedes.train1,msedes.train1,mapedes.train1))
row.names(akurasides.1)<- c("SSE", "MSE", "MAPE")
colnames(akurasides.1) <- c("Akurasi lamda=0.2 dan gamma=0.2")
akurasides.1

ssedes.train2<-des.2$SSE
msedes.train2<-ssedes.train2/length(train.ts)
sisaandes2<-ramalandes2$residuals
head(sisaandes2)

mapedes.train2 <- sum(abs(sisaandes2[3:length(train.ts)]/train.ts[3:length(train.ts)])
                      *100)/length(train.ts)

akurasides.2 <- matrix(c(ssedes.train2,msedes.train2,mapedes.train2))
row.names(akurasides.2)<- c("SSE", "MSE", "MAPE")
colnames(akurasides.2) <- c("Akurasi lamda=0.6 dan gamma=0.3")
akurasides.2
```

Hasil akurasi dari data latih didapatkan skenario 2 dengan lamda = 0.6 dan gamma = 0.3 memiliki hasil yang lebih baik dibandingkan dengan skenario 1 berdasarkan nilai MAPE-nya. Namun untuk kedua skenario dapat dikategorikan peramalan baik berdasarkan nilai MAPE-nya (dibawah 20%).

#### Akurasi Data Uji

```{r}
selisihdes1<-ramalandes1$mean-testing$Harga
selisihdes1

SSEtestingdes1<-sum(selisihdes1^2)
MSEtestingdes1<-SSEtestingdes1/length(testing$Harga)
MAPEtestingdes1<-sum(abs(selisihdes1/testing$Harga)*100)/length(testing$Harga)

selisihdes2<-ramalandes2$mean-testing$Harga
selisihdes2

SSEtestingdes2<-sum(selisihdes2^2)
MSEtestingdes2<-SSEtestingdes2/length(testing$Harga)
MAPEtestingdes2<-sum(abs(selisihdes2/testing$Harga)*100)/length(testing$Harga)

selisihdesopt<-ramalandesopt$mean-testing$Harga
selisihdesopt

SSEtestingdesopt<-sum(selisihdesopt^2)
MSEtestingdesopt<-SSEtestingdesopt/length(testing$Harga)
MAPEtestingdesopt<-sum(abs(selisihdesopt/testing$Harga)*100)/length(testing$Harga)

akurasitestingdes <-
  matrix(c(SSEtestingdes1,MSEtestingdes1,MAPEtestingdes1,SSEtestingdes2,MSEtestingdes2,
           MAPEtestingdes2,SSEtestingdesopt,MSEtestingdesopt,MAPEtestingdesopt),
         nrow=3,ncol=3)
row.names(akurasitestingdes)<- c("SSE", "MSE", "MAPE")
colnames(akurasitestingdes) <- c("des ske1","des ske2","des opt")
akurasitestingdes
```

Berdasarkan hasil akurasi data uji, hasil analisis menunjukkan bahwa model Double Exponential Smoothing (DES) skenario 2 dengan parameter α = 0.6 dan β = 0.3 dan skenario optimum memberikan performa terbaik dibandingkan skenario 1. Hal ini terlihat dari nilai MAPE pada data uji yang berada di bawah 20%, sehingga model dapat dikategorikan cukup akurat dalam memprediksi harga kopi. Dengan demikian, model ini layak dijadikan acuan untuk peramalan harga kopi ke depan, terutama karena data menunjukkan adanya pola tren yang sesuai dengan pendekatan DES.

### Membandingkan dengan Metode Pemulusan SES (Single Exponential Smoothing)

```{r}
ses1<- HoltWinters(train.ts, gamma = FALSE, beta = FALSE, alpha = 0.2)
plot(ses1)

# ramalan
ramalan1<- forecast(ses1, h=20)
ramalan1

ses2<- HoltWinters(train.ts, gamma = FALSE, beta = FALSE, alpha = 0.7)
plot(ses2)

# ramalan
ramalan2<- forecast(ses2, h=20)
ramalan2

sesopt<- HoltWinters(train.ts, gamma = FALSE, beta = FALSE,alpha = NULL)
sesopt
plot(sesopt)

# ramalan
ramalanopt<- forecast(sesopt, h=20)
ramalanopt
```

```{r}
# Akurasi Data Training

## Pada data training
SSE1<-ses1$SSE
MSE1<-ses1$SSE/length(train.ts)
RMSE1<-sqrt(MSE1)

akurasi1 <- matrix(c(SSE1,MSE1,RMSE1))
row.names(akurasi1)<- c("SSE", "MSE", "RMSE")
colnames(akurasi1) <- c("Akurasi lamda=0.2")
akurasi1

SSE2<-ses2$SSE
MSE2<-ses2$SSE/length(train.ts)
RMSE2<-sqrt(MSE2)

akurasi2 <- matrix(c(SSE2,MSE2,RMSE2))
row.names(akurasi2)<- c("SSE", "MSE", "RMSE")
colnames(akurasi2) <- c("Akurasi lamda=0.7")
akurasi2

## Cara Manual
fitted1<-ramalan1$fitted
sisaan1<-ramalan1$residuals
head(sisaan1)

resid1<-training$Harga-ramalan1$fitted
head(resid1)
 SSE.1=sum(sisaan1[2:length(train.ts)]^2)
SSE.1

MSE.1 = SSE.1/length(train.ts)
MSE.1

MAPE.1 = sum(abs(sisaan1[2:length(train.ts)]/train.ts[2:length(train.ts)])*
               100)/length(train.ts)
MAPE.1

akurasi.1 <- matrix(c(SSE.1,MSE.1,MAPE.1))
row.names(akurasi.1)<- c("SSE", "MSE", "MAPE")
colnames(akurasi.1) <- c("Akurasi lamda=0.2")
akurasi.1

fitted2<-ramalan2$fitted
sisaan2<-ramalan2$residuals
head(sisaan2)

resid2<-training$Harga-ramalan2$fitted
head(resid2)

SSE.2=sum(sisaan2[2:length(train.ts)]^2)
SSE.2

MSE.2 = SSE.2/length(train.ts)
MSE.2

MAPE.2 = sum(abs(sisaan2[2:length(train.ts)]/train.ts[2:length(train.ts)])*
               100)/length(train.ts)
MAPE.2

akurasi.2 <- matrix(c(SSE.2,MSE.2,MAPE.2))
row.names(akurasi.2)<- c("SSE", "MSE", "MAPE")
colnames(akurasi.2) <- c("Akurasi lamda=0.7")
akurasi.2
```

```{r}
# Akurasi Data Uji

selisih1<-ramalan1$mean-testing$Harga
SSEtesting1<-sum(selisih1^2)
MSEtesting1<-SSEtesting1/length(testing)

selisih2<-ramalan2$mean-testing$Harga
SSEtesting2<-sum(selisih2^2)
MSEtesting2<-SSEtesting2/length(testing)

selisihopt<-ramalanopt$mean-testing$Harga
SSEtestingopt<-sum(selisihopt^2)
MSEtestingopt<-SSEtestingopt/length(testing)

akurasitesting1 <- matrix(c(SSEtesting1,SSEtesting2,SSEtestingopt))
row.names(akurasitesting1)<- c("SSE1", "SSE2", "SSEopt")
akurasitesting1

akurasitesting2 <- matrix(c(MSEtesting1,MSEtesting2,MSEtestingopt))
row.names(akurasitesting2)<- c("MSE1", "MSE2", "MSEopt")
akurasitesting2
```

```{r}
accuracy(ramalanopt,testing$Harga)
```

```{r}
# Perbandingan SES dan DES

MSEfull <-
  matrix(c(MSEtesting1,MSEtesting2,MSEtestingopt,MSEtestingdes1,MSEtestingdes2,
           MSEtestingdesopt),nrow=3,ncol=2)
row.names(MSEfull)<- c("ske 1", "ske 2", "ske opt")
colnames(MSEfull) <- c("ses","des")
MSEfull
```

Metode DES memberikan hasil peramalan yang lebih akurat dibandingkan SES dikarenakan nilai MSE yang jauh lebih rendah. Hal ini menunjukkan bahwa data kopi memiliki pola tren sehingga DES lebih cocok digunakan.
